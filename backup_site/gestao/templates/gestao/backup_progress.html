{% extends "admin/base_site.html" %}
{% block content %}
<h2>Backup com Barra de Progresso</h2>
<button id="start-backup">Iniciar Backup</button>
<div id="progress-bar" style="width:100%;background:#eee;margin-top:20px;">
  <div id="progress" style="width:0%;background:#4caf50;color:#fff;text-align:center;">0%</div>
</div>
<script>
document.getElementById('start-backup').onclick = function() {
    fetch('/gestao/start-backup/')
      .then(response => response.json())
      .then(data => {
        var taskId = data.task_id;
        var interval = setInterval(function() {
          fetch('/gestao/backup-progress/' + taskId + '/')
            .then(response => response.json())
            .then(data => {
              var progress = data.progress;
              document.getElementById('progress').style.width = progress + '%';
              document.getElementById('progress').innerText = progress + '%';
              if (progress >= 100) clearInterval(interval);
            });
        }, 1000);
      });
};
</script>
{% endblock %} 